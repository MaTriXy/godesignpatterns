<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="VqGny1x9EAeoXjY8v2hWFZGBUZFNQnavIOXVkY50mdk" />
    <meta name="msvalidate.01" content="AFECEF07C08280E3BFA946DDCE26B76C" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@alexjlockwood" />
    <meta name="twitter:creator" content="@alexjlockwood" />
    <meta name="twitter:domain" content="" />
    
    <meta name="description" content="Android Design Patterns is a website for developers who wish to better understand the Android application framework. The tutorials here emphasize proper code design and project maintainability." />
    <meta name="twitter:description" content="Android Design Patterns is a website for developers who wish to better understand the Android application framework. The tutorials here emphasize proper code design and project maintainability." />
    
    <meta property="og:locale" content="en_US" />
    <meta property="og:title" content="Android Design Patterns" />
    
    <meta property="og:type" content="blog" />
    
    <meta property="og:url" content="/page2/index.html" />
    <meta property="og:site_name" content="Android Design Patterns" />
    
    <meta property="og:image" content="/assets/images/favicon.jpg" />
    <title>Android Design Patterns</title>
    <link rel="canonical" href="/page2/index.html" />
    <link rel="icon" href="/assets/images/favicon.jpg" type="image/x-icon">
    <link href="/feed.atom" rel="alternate" title="Android Design Patterns - Feed" type="application/atom+xml" />
    <link rel="stylesheet" type="text/css" href="/css/all.css" />

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
  </head>

  <body>
    <div id="header">
      <div class="container">
        <h3 id="blog-header"><a href="/">Android Design Patterns</a></h3>
        <nav class="pull-right">
          <a href="/archives/">Archives</a>
          <a href="/about/">About</a>
        </nav>
      </div>
    </div>

    <div id="social" class="container">
      <a href="https://plus.google.com/100751609891157863386?rel=author" class="googleplus"><i class="icon-gplus"></i></a>
      <a href="https://twitter.com/alexjlockwood" class="twitter"><i class="icon-twitter"></i></a>
      <a href="https://github.com/alexjlockwood" class="github"><i class="icon-github-circled"></i></a>
      <a href="/feed.atom" class="rss"><i class="icon-rss"></i></a>
    </div>

    <div class="main container">
      <div id="content">
	<div class="blog-index">
          
  <article class="snippet">
    <div class="side">
      <div class="date-posted">
        <span class="date-block">Jul 31 2013</span>
      </div>
    </div>
    <div class="body">
      <header><h2 class="post-title no-border"><a href="/2013/07/binders-window-tokens.html">Binders &amp; Window Tokens</a></h2></header>
      <blockquote>
<p>Note: if you liked this post, be sure to read my second blog post about
<a href="/2013/08/binders-death-recipients.html">Binders &amp; Death Recipients</a>
as well!</p>
</blockquote>

<p>One of Android&#39;s key design goals was to provide an open platform that doesn&#39;t rely on a
central authority to verify that applications do what they claim. To achieve this, Android
uses application sandboxes and Linux process isolation to prevent applications from being
able to access the system or other applications in ways that are not controlled and secure.
This architecture was chosen with both developers and device users in mind: neither should
have to take extra steps to protect the device from malicious applications. Everything
should be taken care of automatically by the system.</p>

<p>For a long time I took this security for granted, not completely understanding how it was
actually enforced. But recently I became curious. What mechanism prevents me from, for
example, tricking the system into releasing a wake lock acquired by another application,
or from hiding another application&#39;s windows from the screen? More generally, how do
Android&#39;s core system services respond to requests made by third-party applications
in a way that is both efficient and secure?</p>

      <footer>
        <a class="read-more" href="/2013/07/binders-window-tokens.html">Read more&#8230;</a>
      </footer>
    </div>
    <div class="clearfix"></div>
  </article>
  

  <article class="snippet">
    <div class="side">
      <div class="date-posted">
        <span class="date-block">Apr 29 2013</span>
      </div>
    </div>
    <div class="body">
      <header><h2 class="post-title no-border"><a href="/2013/04/retaining-objects-across-config-changes.html">Handling Configuration Changes with Fragments</a></h2></header>
      <p>This post addresses a common question that is frequently asked on <a href="http://stackoverflow.com/q/3821423/844882">StackOverflow</a>:</p>

<blockquote>
<p>What is the best way to retain active objects&mdash;such as
running <code>Thread</code>s, <code>Socket</code>s, and <code>AsyncTask</code>s&mdash;across
device configuration changes?</p>
</blockquote>

<p>To answer this question, we will first discuss some of the common
difficulties developers face when using long-running background tasks
in conjunction with the Activity lifecycle. Then, we will describe
the flaws of two common approaches to solving the problem. Finally,
we will conclude with sample code illustrating the recommended
solution, which uses retained Fragments to achieve our goal.</p>

      <footer>
        <a class="read-more" href="/2013/04/retaining-objects-across-config-changes.html">Read more&#8230;</a>
      </footer>
    </div>
    <div class="clearfix"></div>
  </article>
  
  <!-- Display ad after second post snippet -->
  <!--<div id="responsive-home-page-first-ad">
    <ins class="adsbygoogle"
	 style="display:block"
	 data-ad-client="ca-pub-3588752900040136"
	 data-ad-slot="7147625658"
	 data-ad-format="auto"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>-->
  

  <article class="snippet">
    <div class="side">
      <div class="date-posted">
        <span class="date-block">Apr 15 2013</span>
      </div>
    </div>
    <div class="body">
      <header><h2 class="post-title no-border"><a href="/2013/04/activitys-threads-memory-leaks.html">Activitys, Threads, &amp; Memory Leaks</a></h2></header>
      <blockquote>
<p>Note: the source code in this blog post is available on
<a href="https://github.com/alexjlockwood/leaky-threads">GitHub</a>.</p>
</blockquote>

<p>A common difficulty in Android programming is coordinating long-running tasks
over the Activity lifecycle and avoiding the subtle memory leaks which might
result. Consider the Activity code below, which starts and loops a new thread
upon its creation:</p>

<div class="scrollable">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Example illustrating how threads persist across configuration</span>
<span class="cm"> * changes (which cause the underlying Activity instance to be</span>
<span class="cm"> * destroyed). The Activity context also leaks because the thread</span>
<span class="cm"> * is instantiated as an anonymous class, which holds an implicit</span>
<span class="cm"> * reference to the outer Activity instance, therefore preventing</span>
<span class="cm"> * it from being garbage collected.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">exampleOne</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">exampleOne</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">SystemClock</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}.</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

</div>

      <footer>
        <a class="read-more" href="/2013/04/activitys-threads-memory-leaks.html">Read more&#8230;</a>
      </footer>
    </div>
    <div class="clearfix"></div>
  </article>
  

  <article class="snippet">
    <div class="side">
      <div class="date-posted">
        <span class="date-block">Jan 14 2013</span>
      </div>
    </div>
    <div class="body">
      <header><h2 class="post-title no-border"><a href="/2013/01/inner-class-handler-memory-leak.html">How to Leak a Context: Handlers &amp; Inner Classes</a></h2></header>
      <p>Consider the following code:</p>

<div class="scrollable">

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><code class="java">1
2
3
4
5
6
7
8
9</code></pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Handler</span> <span class="n">mLeakyHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// ... </span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>

</div>

<p>While not readily obvious, this code can cause cause a massive memory leak.
Android Lint will give the following warning: </p>

<blockquote>
<p>In Android, Handler classes should be static or leaks might occur.</p>
</blockquote>

<p>But where exactly is the leak and how might it happen? Let&#39;s determine the
source of the problem by first documenting what we know:</p>

      <footer>
        <a class="read-more" href="/2013/01/inner-class-handler-memory-leak.html">Read more&#8230;</a>
      </footer>
    </div>
    <div class="clearfix"></div>
  </article>
  


  <div class="mod-pagination">
    
      
        <div class="prev"><a rel="prev" href="/">&#171; Newer</a></div>
      
    
    
      <div class="next"><a rel="next" href="/page3">Older &#187;</a></div>
    
  </div>


	</div>
      </div>

      <div id="info" class="cf">
	<div class="right">
          <div class="box">
            <h3>About this Blog</h3>
            <p>Android Design Patterns is a website for developers who wish to better understand the Android application framework. The tutorials here emphasize proper code design and project maintainability.</p>
            <div class="g-plusone" data-annotation="inline" data-width="300" data-href=""></div>
          </div>
          <div class="box">
            <h3>Find a typo?</h3>
            <p>Submit a pull request! The code powering this site is open-source and available on <a href="https://github.com/alexjlockwood/alexjlockwood.github.io">GitHub</a>. Corrections are appreciated and encouraged! Click <a href="https://github.com/alexjlockwood/alexjlockwood.github.io/blob/master/README.md#find-a-typo">here</a> for instructions.</p>
          </div>
	</div>
	<div class="box gbadge">
          <div class="g-person" data-href="//plus.google.com/+AlexLockwood" data-rel="author"></div>
	</div>
      </div>
    </div>

    <div id="responsive-home-page-bottom-ad" class="container">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-3588752900040136"
           data-ad-slot="3555030858"
           data-ad-format="auto"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <div id="copyright" class="container">
      <p>&copy; 2012-2014 Android Design Patterns</p>
    </div>

    <script type="text/javascript">
      (function(){var a=document.createElement("script");
      a.type="text/javascript";a.async=true;a.src="https://apis.google.com/js/platform.js";
      var b=document.getElementsByTagName("script")[0];
      b.parentNode.insertBefore(a,b)})();
    </script>

  </body>
</html>
